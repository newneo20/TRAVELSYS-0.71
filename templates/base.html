{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Meta etiquetas para diseño responsivo -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TravelSYS{% endblock %}</title>
    
    <!-- Bootstrap CSS actualizado -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome actualizado -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts: Fuente moderna -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS personalizado -->
    <link rel="stylesheet" type="text/css" href="{% static 'usuarios/styles.css' %}">
    
    <!-- Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />
    
    <!-- Date Range Picker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">

</head>
<body class="bg-light">    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <div class="navbar-brand-wrapper">
                {% if request.user.is_authenticated and request.user.is_manager %}
                    <a class="navbar-brand" href="{% url 'dashboard' %}">
                        <img src="{% static 'images/TRAVELSYS_logo_B.png' %}" alt="Logo TRAVELSYS" class="me-2" style="height: 40px;">
                        <span class="brand-text">
                            <span class="brand-text-travel">TRAVEL</span><span class="brand-text-sys">SYS</span>
                        </span>
                    </a>
                {% else %}
                    <span class="navbar-brand">
                        <img src="{% static 'images/TRAVELSYS_logo_B.png' %}" alt="Logo TRAVELSYS" class="me-2" style="height: 40px;">
                        <span class="brand-text">
                            <span class="brand-text-travel">TRAVEL</span><span class="brand-text-sys">SYS</span>
                        </span>
                    </span>
                {% endif %}
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <span class="nav-link">Bienvenido, {{ user.first_name }} {{ user.last_name }}</span>
                        </li>
                        <li class="nav-item">
                            <form method="post" action="{% url 'logout' %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-light"><i class="fa-solid fa-arrow-right-from-bracket"></i></button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}">Iniciar sesión</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="content-wrapper">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">        
            <div class="section-header" data-target="booking-section">
                <div>
                    <span class="icon-parent"><i class="fas fa-book"></i></span>
                    Booking
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="booking-section" class="section-content">
                <a href="{% url 'booking:user_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'user_dashboard' %}active{% endif %}">
                    <span class="icon-parent"><i class="fas fa-tachometer-alt"></i></span>
                    Dashboard de Usuarios
                </a>
                <a href="{% url 'booking:hotel_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'hotel_dashboard' %}active{% endif %}">
                    <span class="icon-parent"><i class="fas fa-search-location"></i></span>
                    Buscar Hoteles
                </a>
            </div>
            <div class="section-header" data-target="backoffice-section">
                <div>
                    <span class="icon-parent"><i class="fas fa-cogs"></i></span>
                    Backoffice
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="backoffice-section" class="section-content">      
                
                {% if user.is_manager %}
                    <!-- ========================= -->                
                    <!-- Enlace para Links Basicos -->
                    <!-- ========================= -->
                    <a href="{% url 'dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <span class="icon-parent"><i class="fas fa-chart-line"></i></span>
                        Panel de Control
                    </a>               
                    
                    <a href="{% url 'backoffice:listar_reservas' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_reservas' %}active{% endif %}">
                        <span class="icon-parent"><i class="fas fa-calendar-check"></i></span>
                        Reservas
                    </a>
                    <a href="{% url 'listar_usuarios' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_usuarios' %}active{% endif %}">
                        <span class="icon-parent"><i class="fas fa-users"></i></span>
                        Usuarios
                    </a>
                    <a href="{% url 'backoffice:listar_ofertas_especiales' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_ofertas_especiales' %}active{% endif %}">
                        <span class="icon-parent"><i class="fas fa-gift"></i></span>
                        Ofertas Especiales
                    </a>
                    <a href="{% url 'backoffice:listar_proveedores' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_proveedores' %}active{% endif %}">
                        <span class="icon-parent"><i class="fas fa-truck-fast"></i></span>
                        Proveedores
                    </a>

                    <!-- ================================== -->                
                    <!-- Enlace para Movimientos Financieros-->
                    <!-- ================================== -->                
                    <div class="submenu">
                        <a href="#financioeroSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                            <span class="icon-parent"><i class="fas fa-city"></i></span>
                            Movimientos Financieros
                        </a>
                        <ul class="collapse list-unstyled" id="financioeroSubmenu">
                            <li>
                                <a href="{% url 'listar_reservas_finanzas' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_reservas_finanzas' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-exchange-alt"></i></span>
                                    Movimientos Financieros
                                </a>
                            </li>                            
                            <li>
                                <a href="{% url 'backoffice:listar_tasas_cambio' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_tasas_cambio' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-money-bill-wave"></i></span>
                                    Tasas de Cambio
                                </a>
                            </li>
                                                   
                        </ul>
                    </div>

                    <!-- =================== -->                
                    <!-- Enlace para Hoteles -->
                     <!-- =================== -->                
                    <div class="submenu">
                        <a href="#hotelesSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                            <span class="icon-parent"><i class="fas fa-city"></i></span>
                            Hoteles
                        </a>
                        <ul class="collapse list-unstyled" id="hotelesSubmenu">
                            <li>
                                <a href="{% url 'backoffice:listar_hoteles' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_hoteles' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-hotel"></i></span>
                                    Lista de Hoteles
                                </a>
                            </li>                            
                            <li>
                                <a href="{% url 'backoffice:listar_polos' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_polos' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-location-dot"></i></span>
                                    Polos Turísticos
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'backoffice:listar_cadenas_hoteleras' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_cadenas_hoteleras' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-building"></i></span>
                                    Cadenas Hoteleras
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'backoffice:listar_pasajeros' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_pasajeros' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-user-friends"></i></span>
                                    Pasajeros
                                </a>
                            </li>                            
                        </ul>
                    </div>

                    <!-- ===================== -->                
                    <!-- Enlace para Traslados -->
                    <!-- ===================== -->                
                    <div class="submenu">
                        <a href="#trasladosSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                            <span class="icon-parent"><i class="fas fa-receipt"></i></span>
                            Traslados
                        </a>
                        <ul class="collapse list-unstyled" id="trasladosSubmenu">
                            <li>
                                <!-- Enlace para Traslados -->
                                <a href="{% url 'backoffice:listar_traslados' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_traslados' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-bus"></i></span>
                                    Traslados
                                </a>
                            </li>                            
                            <li>
                                <!-- Enlace para Transportistas -->
                                <a href="{% url 'backoffice:listar_transportistas' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_transportistas' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-truck"></i></span>
                                    Transportistas
                                </a>
                            </li>                            
                            <li>
                                <!-- Enlace para Ubicaciones -->
                                <a href="{% url 'backoffice:listar_ubicaciones' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_ubicaciones' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-map-marker-alt"></i></span>
                                    Ubicaciones
                                </a>
                            </li>
                            <li>
                                <!-- Enlace para Vehículos -->
                                <a href="{% url 'backoffice:listar_vehiculos' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_vehiculos' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-car"></i></span>
                                    Vehículos
                                </a>
                            </li>
                            
                        </ul>
                    </div>
                    
                    <!-- ===================================== -->                
                    <!-- Enlace para Cerificados de Vacaciones -->
                    <!-- ===================================== -->                
                    <div class="submenu">
                        <a href="#certificadosSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                            <span class="icon-parent"><i class="fas fa-passport"></i></span>
                            Certificados Vacaciones
                        </a>
                        <ul class="collapse list-unstyled" id="certificadosSubmenu">
                            <li>
                                <a href="{% url 'backoffice:listar_certificados' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_certificados' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-list-alt"></i></span>
                                    Lista de Certificados
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'backoffice:listar_opciones_certificado' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_opciones_certificado' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-cogs"></i></span>
                                    Opciones de Certificado
                                </a>
                            </li>
                                                 
                        </ul>
                    </div>
                    
                    <!-- ================== -->                
                    <!-- Enlace para Carros -->
                    <!-- ================== -->   
                    <div class="submenu">
                        <a href="#carrosSubmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle nav-link">
                            <span class="icon-parent"><i class="fas fa-car"></i></span>
                            Carros
                        </a>
                        <ul class="collapse list-unstyled" id="carrosSubmenu">
                            <li>
                                <a href="{% url 'backoffice:listar_rentadoras' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_rentadoras' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-car"></i></span>
                                    Rentadoras
                                </a>                                
                            </li>
                            <li>
                                <a href="{% url 'backoffice:listar_categorias' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_categorias' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-tags"></i></span>
                                    Categorías de Carros
                                </a>                                
                            </li>
                            <li>
                                <a href="{% url 'backoffice:listar_modelos_autos' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_modelos_autos' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-car-side"></i></span>
                                    Modelos de Autos
                                </a>                                
                            </li>                            
                            <li>
                                <a href="{% url 'backoffice:listar_locations' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_locations' %}active{% endif %}">
                                    <span class="icon-parent"><i class="fas fa-map-marker-alt"></i></span>
                                    Locations
                                </a>                                
                            </li>                            
                        </ul>
                    </div>
                {% endif %}
            </div>
            
            <div class="section-header" data-target="development-section">
                <div>
                    <span class="icon-parent"><i class="fas fa-code"></i></span>
                    En desarrollo
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="development-section" class="section-content">
                <a href="{% url 'backoffice:en_desarrollo' %}" class="nav-link">
                    <span class="icon-parent"><i class="fas fa-plane"></i></span>
                    Aerolíneas
                </a>
                <a href="{% url 'backoffice:en_desarrollo' %}" class="nav-link">
                    <span class="icon-parent"><i class="fas fa-globe"></i></span>
                    Destinos
                </a>
                <a href="{% url 'backoffice:en_mantenimiento' %}" class="nav-link">
                    <span class="icon-parent"><i class="fas fa-map-pin"></i></span>
                    Puntos de Recogida
                </a>
            </div>
            
        </div>

        <!-- Main Content -->
        <div id="content">
            <button id="menu-toggle" class="btn btn-primary d-lg-none">
                <i class="fas fa-bars"></i>
            </button>
            {% block content %}
            <!-- Contenido específico de cada página -->
            {% endblock %}
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-4 text-center mt-5">
        <div class="container">
            <p>&copy; 2024 TravelSYS.com Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- jQuery (Requerido por Bootstrap y otros plugins) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS (Bundle incluye Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <!-- Date Range Picker JS -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Inicializar Select2
            $('.form-select').select2({
                theme: 'bootstrap-5'
            });

            // Inicializar Date Range Picker
            $('.date-picker').daterangepicker({
                singleDatePicker: true,
                locale: {
                    format: 'YYYY-MM-DD'
                }
            });

            // Toggle del menú lateral
            $('#menu-toggle').click(function(e) {
                e.preventDefault();
                $('#sidebar').toggleClass('active');
                $('#content').toggleClass('active');
            });

            // Toggle de las secciones del sidebar
            $('.section-header').click(function() {
                var target = $(this).data('target');
                $('#' + target).slideToggle(300);
                $(this).find('i.fas.fa-chevron-down').toggleClass('rotate-icon');
            });

            // Expandir la sección activa por defecto
            var activeLink = $('#sidebar a.active');
            if (activeLink.length) {
                activeLink.closest('.section-content').show();
                activeLink.closest('.section-content').prev('.section-header').find('i.fas.fa-chevron-down').addClass('rotate-icon');
            }

            // Cerrar el sidebar en dispositivos móviles al hacer clic en un enlace
            if ($(window).width() < 992) {
                $('#sidebar .nav-link').click(function() {
                    $('#sidebar').removeClass('active');
                    $('#content').removeClass('active');
                });
            }

            // Ajustar el sidebar al cambiar el tamaño de la ventana
            $(window).resize(function() {
                if ($(window).width() >= 992) {
                    $('#sidebar').addClass('active');
                    $('#content').addClass('active');
                } else {
                    $('#sidebar').removeClass('active');
                    $('#content').removeClass('active');
                }
            });

            // Ejecutar el ajuste al cargar la página
            $(window).trigger('resize');
        });

        // Configura el intervalo para verificar la sesión cada 5 minutos (300000 ms)
        setInterval(function() {
            fetch("{% url 'check_session' %}")
                .then(response => {
                    if (!response.ok) {
                        // Si la respuesta no es 200 OK, redirige al inicio de sesión
                        window.location.href = "{% url 'login' %}";  // Ajusta 'login' al nombre de tu URL de inicio de sesión
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status !== 'active') {
                        // Redirige al usuario al inicio de sesión si el estado no es "active"
                        window.location.href = "{% url 'login' %}";
                    }
                })
                .catch(error => {
                    console.error("Error verificando el estado de la sesión:", error);
                    // También puedes redirigir al inicio de sesión en caso de error
                    window.location.href = "{% url 'login' %}";
                });
        }, 30000);  // Verifica cada 5 minutos
    </script>

</body>
</html>
